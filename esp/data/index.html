<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SCK Setup</title>
  </head>
  <body>

    <div id="loading">
      <h1 style="color:#38cef3; font-family:Arial, sans-serif; padding:100px 10px;">The page is loading... please wait!</h1>
    </div>

    <div class="container" id="app">

      <div class="topnav sticky ">
        <div class="bg-blue">

          <p class="text-center">SCK 2.0 Setup</p>

          <a v-show="page[currentPage].back" id="topbackbtn" v-on:click="gotoPage(currentPage - 1)" href="#">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><g><polygon points="55.7,33.8 39.7,50.2 56.1,66.3 58.9,63.4 45.3,50.1 58.6,36.6  "/></g></svg>
          </a>

          <a v-show="!page[currentPage].back" href="/">
            <img id="toplogo" src="images/sck.png">
          </a>

          <div id="topinfo">
            <a v-on:click='gotoPage(6)'>
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><g><g><g><path d="M53.1,73h-7.2c-1.1,0-1.9-0.9-1.9-1.9V44h11v27.1C55,72.1,54.1,73,53.1,73z"/></g></g></g><g><g><g><path d="M55,39H44v-9.1c0-1.1,0.9-1.9,1.9-1.9h7.2c1.1,0,1.9,0.9,1.9,1.9V39z"/></g></g></g><g><path d="M50,96C24.6,96,4,75.4,4,50S24.6,4,50,4s46,20.6,46,46S75.4,96,50,96z M50,12c-21,0-38,17-38,38s17,38,38,38s38-17,38-38   S71,12,50,12z"/></g></svg>
            </a>
          </div>

        </div>

        <div id="toast-wrapper"></div>
      </div>

      <div class="content">

        <div v-show="showAdvanced">
          <button class="" type="button" v-on:click='gotoPage("0")'>Start</button>
          <button class="" type="button" v-on:click='gotoPage()'>Next</button>
          <hr />
        </div>

        <div v-show='page[0].visible'>
          <h1 class="text-cyan text-center">WELCOME TO SMART CITIZEN KIT CONFIGURATION</h1>
          <p>Is this your first time here?</p>
          <p>Remember before you start you need to visit <span class="text-cyan">onboarding.smartcitizen.me</span> to obtain a Device Key</p>

          <button class="btn bg-cyan" id="start" type="button" v-on:click='gotoPage()'>Start</button>
          <p>or go to <span class='text-cyan'>
            <a v-on:click='gotoPage(5)'>SD Card mode</a></span>
          </p>
        </div>

        <div v-show='page[1].visible'>
          <h4>Device key</h4>

          <div class="field-token">
            <label>Token</label>
            <input name="token" type="text" maxlength="6" v-model='usertoken' minlength="6" placeholder="6 letters">
          </div>
          <p v-show='!usertokenCheck'>
          {{ 6 - usertoken.length }} letters missing.
          </p>
          <button class="btn next" v-bind:class="{ 'bg-cyan': usertokenCheck }" type="button" :disabled=!usertokenCheck v-on:click='gotoPage()'>Next</button>

        </div>

        <div v-show='page[2].visible'>
          <h4>WiFi connection</h4>
          <div class="field-wifi">
            <label>SSID (Network name)</label>
            <select v-model="selectedWifi" name="ssid" id="ssid" type="text" length=64>
              <!-- Here goes the Access point list -->
              <option disabled value="">Select your wifi ({{wifis["nets"].length}})</option>
              <option v-for="x in sortedWifi" :key="x.rssi" :value="x.ssid">{{x.ssid}} ({{x.rssi}}, {{x.ch}})</option>
            </select>
          </div>
          <div class="field-group">
            <label>Password</label>
            <input name="password" type="text" v-model='wifipass' length=64 placeholder="Your wifi password">
          </div>
          <button class="btn bg-cyan" type="button" id="connect" v-on:click="jsPost('set','connect')">Connect</button>


        </div>

        <div v-show='page[3].visible'>
          <h4>Trying to connect..</h4>

          <p>Your kit is now trying to connect to the online platform, and this website has no connection to the kit anymore.</p>
          <p>Check the light on your Kit:</p>
          <ul>
            <li><span style="color:green">GREEN</span>: Everything is fine, your Kit is online.</li>
            <li><span style="color:red">RED</span>: Some problem happened, push the button on your Kit and join the SCK WiFi again.</li>
          </ul>
        </div>

        <div v-show='page[4].visible'>
          <h4 style="text-cyan">Your kit status</h4>

          <table>
            <tr>
              <td>Mode</td>
              <td>Network</td>
            </tr>
            <tr>
              <td>Wifi</td>
              <td>Connection lost</td>
            </tr>
            <tr>
              <td>Battery</td>
              <td>85%</td>
            </tr>
            <tr>
              <td>Published</td>
              <td>20 min ago</td>
            </tr>
          </table>
          <p>If you want to run a full setup again, press the button on your Kit for 15 seconds and reconnect, and refresh this page.</p>

          <button class="btn bg-cyan" type="button" v-on:click='gotoPage(2)'>Edit Wifi</button>
        </div>


        <div v-show='page[5].visible'>
          <h4>SD Card</h4>
          <p>Your Kit can store the data on a microSD card that later you can read with your computer.</p>
          <p>This is useful when no WiFi is available at your location.</p>
          <p>You will need to insert a valid microSD card and click the button.</p>
          <table>
            <tr>
              <td>SD CARD</td>
              <td>Insert a card</td>
            </tr>
            <tr>
              <td>TIME SYNC</td>
              <td>Ready</td>
            </tr>
          </table>
          <button class="btn bg-cyan" type="button" v-on:click="jsPost('set', 'synctime')">START LOGGING</button>
          <p>You will be disconnected and the Kit will start recording data.</p>
        </div>

        <div v-show='page[6].visible'>
          <h4>Debug info</h4>

          <label for="label-advanced" class="font80">
            <input type="checkbox" name="" id="label-advanced" value="" v-model="showAdvanced"/>
            Enable advanced (debug mode)
          </label>
          <label for="label-experimental" class="font80">
            <input type="checkbox" name="" id="label-experimental" value="" v-model="showExperimental"/>
            Show Experimental (UNSTABLE!)
          </label>


          <div id="id-logging">
            <hr />
            <p>Logging:</p>
            <ul v-show="logging && logging.length">
              <li v-for="x in logging" class="font70">
                {{x}}
              </li>
            </ul>
          </div>

          <button class="btn " type="button" v-on:click='gotoPage("0")'>Back to the beginning</button>
        </div>

        <div v-show='page[7].visible'>
          <h4>Empty page</h4>
        </div>

        <br />
        <br />

        <div class="text-center text-grey font80">
          {{ version }}
          <hr />
          {{ currentPage }} - {{ page[currentPage].footer }}
        </div>

        <br />



        <!-- advanced, only accessible in debug mode -->

        <div v-show="showExperimental" id="advanced" class="mt20">
          <p v-show="development">Development mode</p>

          <label for="id-show-interval">
            <input type="checkbox" name="" id="id-show-interval" value="" v-model="showInterval" />
            Intervals
          </label>

          <div v-show="showInterval" id="intervals">
            <h5>Global - Intervals</h5>
            <div>
              <p class="font70">How often should the kit go online to publish the data?</p>
              <label for="pubint">Publish interval hours: {{publishinterval}}</label>
              <input type="range" name="pubint" id="" v-model="publishinterval" max="100" />
            </div>
            <div>
              <p class="font70">How often should the kit poll the sensors?</p>
              <label for="readint">Reading interval seconds: {{readinginterval}}</label>
              <input type="range" name="readint" id="" value="60" v-model="readinginterval" max="1000" />
            </div>
            <div>
              <p>Estimated battery duration: {{ Number(publishinterval * (readinginterval / 100)).toFixed(1) }} Hours</p>
            </div>
          </div>

          <hr />

          <label for="id-showsdcard">
            <input type="checkbox" name="" id="id-showsdcard" value="" v-model="showSdCard" />
            SD Card
          </label>

          <div v-show="showSdCard" id="sdcard">

            <h5>SD CARD</h5>
            <div>
              <p class="font70">The kit should never post my data with Wifi</p>
              <label for="sdlog">
                <input type="checkbox" name="usesdcard" id="sdlog" value="" v-model="sdlog" />
                Log *only* to SD Card
              </label>
            </div>
            <br />

            <div v-if="sdlog">
              <p class="font70">When your kit runs out of battery, it loses the time. This will allow the kit to go online and fetch the time.</p>
              <p class="font70">If you don't, all your measurements will be dated from the year 1971</p>
              <label for="usewifisync">
                <input type="checkbox" name="usewifisync" id="usewifisync" v-model="wifisync" />
                Use Wifi to sync time
              </label>
              <p v-if="!wifipass && wifisync" class="text-red font80">Don't forget to give the kit your wifi password!</p>
            </div>
            <div v-show="browsertime != devicetime" id="timesync">
              <table>
                <tr><td>Browser time:</td><td>{{ browsertime }}</td></tr>
                <tr><td>Device time: </td><td>{{ devicetime }}</td></tr>
                <tr><td>Diff: </td><td>{{ browsertime - devicetime }}</td></tr>
              </table>
            </div>

            <p class="font70">When you click this button the device will go offline and start working. </p>
            <p class="font70">(You will loose connection to the device)</p>
            <button class="btn bg-red" type="button" v-on:click="jsPost('set', 'synctime')">Start logging on SD Card</button>

          </div> <!-- /sd card -->

          <hr />

          <label for="id-showkit">
            <input type="checkbox" name="" id="id-showkit" value="" v-model="kitinfo" />
            Show kit info
          </label>

          <div id="kitinfo"  v-show="kitinfo" class="font70">
            <p>Kit info:</p>
            <ul v-show="debuginfo">
              <li v-for="value, index in debuginfo"><b>{{index}}</b>: {{value}}</li>
            </ul>
            <button class="btn" type="button" v-on:click="jsGet('status')">Refresh /status</button>
          </div>

          <hr />
          <label for="id-show-sensors">
            <input type="checkbox" name="" id="id-show-sensors" value="" v-model="sensors"/>
            Show sensors
          </label>

          <div id="sensors" v-show="sensors">
            <h5>Sensors</h5>
            <p class="font70">The new SCK allows you to configure each sensor independently.</p>
            <div class="check-sensor">
              <label for="sensorlight">Light
                <input type="checkbox" name="sensor1" id="sensorlight" value="" v-model="sensor1" />
              </label>
            </div>
            <div class="check-sensor">
              <label for="sensormic">Microphone
                <input type="checkbox" name="sensor2" id="sensormic" value="" v-model="sensor2" />
              </label>
            </div>
            <div class="check-sensor">
              <label for="sensorco2">CO2
                <input type="checkbox" name="sensor3" id="sensorco2" value="" v-model="sensor3" />
              </label>
            </div>
            <div class="check-sensor">
              <label for="sensorthermo">Thermometer
                <input type="checkbox" name="sensor4" id="sensorthermo" value="" v-model="sensor4" />
              </label>
            </div>
          </div><!-- /sensors -->

        </div> <!-- /advanced -->

      </div><!-- /content -->
    </div><!-- container -->

    <script src="vue.min.js" type="text/javascript" charset="utf-8" ></script>
    <script src="main.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="css.css" type="text/css" />

  </body>
</html>
